<!--Controlled by AnalysisCtrl  -->
<div style="height: 100%">
<!-- BUTTON CONTAINER -->
	<div class = "topAnalysisControl">
		<div class= "queryRunStatus">
			<div style = "display :table" ng-model = "service.isValidated">
<!-- 							 <div style = "display : table-cell; border-radius:5px;"  -->
<!-- 							 ng-class="{'queryDone' : queryService.queryObject.properties.queryDone, 'queryUndone' : !queryService.queryObject.properties.queryDone}" -->
<!-- 							 title= "A green signal indiactes the query has been executed successfully"> -->
<!-- 							 </div> -->
<!-- 							 <div style= "display : table-cell; padding-left : 5px"><font color= "white">{{queryService.queryObject.properties.queryStatus}}</font></div> -->
			</div> 
			<font color="#D5D5D5">Mode</font>
							<input type="radio" value="computation" 
							   ng-model = "analyst.mode"/> <font color="#D5D5D5">Computed</font>
							<input type="radio"  value= "visualize"
							   ng-model = "analyst.mode"/> <font color="#D5D5D5">Original</font>
						
		</div>
		<div class= "buttonBarContainer">
			<div class = "btn-group" role = "group" style = "margin-left: 55%; width: 100%; height: 100%"  
			 ng-controller= "buttonBarController">
							
							<button class='btn btn-default wa_buttonBar' title = "Download Query Object"><span class = "fa fa-download" ng-click = "exportQuery()"></span></button>
							
							<label class='btn btn-default wa_buttonBar' title = "Upload Query Object"><span class = "fa fa-upload" ></span><input fileread="queryObjectUploaded.file" class='file-upload' type='file'/></label>
							
							<!-- SHOW?HIDE QUERY OBJECT EDITOR button -->
							<button class="btn btn-default wa_buttonBar" title = "Show/Hide Query Object Editor"
															ng-click = "queryService.queryObject.properties.hideQueryObjectPanel = !queryService.queryObject.properties.hideQueryObjectPanel"
															ng-init="queryService.queryObject.properties.hideQueryObjectPanel = true">
									 <span class = "fa fa-pencil-square-o"></span>
							</button>
							
							<!-- CLEAR button --> 
							<button class="btn btn-default wa_buttonBar" title = "Clear visualizations"> <span class = "fa fa-trash-o" ng-click = "clearSessionState()"></span></button>
							
							<!-- SAVE output visuals button -->	 
							<button  class="btn btn-default wa_buttonBar"  title = "Save visualizations" ng-click="saveVisualizations()"> 
							<span  class = "fa fa-floppy-o"></span> 
							</button>
					
							<!-- RUN button -->		
							<button  class="btn btn-primary wa_buttonBar" title = "Run query"
								ng-click="QueryHandlerService.run(queryService.queryObject)" 
								popover="{{queryService.queryObject.properties.validationStatus}}" popover-trigger="mouseenter"  popover-placement="bottom"
								ng-Disabled = "!queryService.queryObject.properties.isQueryValid">
								 <span class = "fa fa-play-circle fa-lg"></span>
							 </button>
							 
<!-- 							 <div style = "display : table-cell; border-radius:5px;"  -->
<!-- 							 ng-class="{'queryDone' : queryService.queryObject.properties.queryDone, 'queryUndone' : !queryService.queryObject.properties.queryDone}" -->
<!-- 							 title= "A green signal indiactes the query has been executed successfully"> -->
<!-- 							 </div> -->
<!-- 							 <div style= "display : table-cell; padding-left : 5px"><font color= "white">{{queryService.queryObject.properties.queryStatus}}</font></div> -->
							<br>
							<div style = "float:left; margin-left : 10px"  ng-class="{'queryDone' : queryService.queryObject.properties.queryDone, 'queryUndone' : !queryService.queryObject.properties.queryDone}" >
							<i class = "fa fa-flag"></i>
							</div>
		</div>
			</div>
			
			
	</div>
<!-- BUTTON CONTAINER END -->
		
		
		<div style = "padding : 30px"></div>
		
		
	<div style="height: 100%" class="container-fluid" style="padding: 5px;">
		<div style="width:100%;">
			<div class="row" style="height: 30%; clear: both">
<!--Indicator and datatable-->
				<div class="databox" style="width: 20%">
					<div id="indicator" class=" header panel-heading">
						<h2>Indicator</h2>
					</div>
					<div class="body" style="width: 100%">
						<div ng-class="{'unvalidatedUI' : !queryService.queryObject.dataTable, 'validatedUI' : queryService.queryObject.dataTable}"
							 title = "Red flags indicate required selections for query validation">
						
							<ui-select ng-model="queryService.queryObject.dataTable" theme="select2" style="width: 97%;">
							    <ui-select-match allow-clear="true" placeholder="Select a data table...">{{$select.selected.title}}</ui-select-match>
								<ui-select-choices repeat="dataTable in queryService.cache.dataTableList | filter : { title : $select.search }">
 							       		 <div ng-bind-html="dataTable.title | highlight: $select.search"></div>
 							        </ui-select-choices>
							</ui-select>
								 
						</div>
						<br/>
<!-- 						<input type="checkbox" -->
<!-- 							ng-model="queryService.queryObject.properties.displayAsQuestions"> -->
<!-- 						Display As Questions</input> -->
						
						
<!-- INDICATOR -->
		<div style="width: 100%;" title = "Red flags indicate required selections for query validation"
							 ng-class="{'unvalidatedUI' : !queryService.queryObject.Indicator, 'validatedUI' : queryService.queryObject.Indicator}">

							<ui-select ng-model="queryService.queryObject.Indicator" theme="select2" style="width: 97%;">
						    	<ui-select-match allow-clear="true" placeholder="Select Indicator...">{{$select.selected.title}}</ui-select-match>
								<ui-select-choices repeat="indicator in queryService.cache.columns | filter : { columnType : 'indicator', title : $select.search }">
						       		 <b ng-bind-html="indicator.title | highlight: $select.search"></b>
						       		 <small>
						       		 	{{indicator.description}}
						       		 </small>
						        </ui-select-choices>
							</ui-select>
						</div>
						
						<br> {{IndicDescription}} 
					  
 <!-- REMAPPING -->
					  	<div  style="overflow-y: scroll; height:60%">
					      <table border="border: 1px solid #0000FF"  ng-show="queryService.queryObject.Indicator">
								<tr> 
									<td  align="center">
										Value
									</td>
									<td  align="center">
										Description
									</td>
									<td   align="center">
										New Value
									</td>
								 </tr>
								<tr ng-repeat="varValue in varValues">
									<td width= "10%" style="padding-left: 5px; padding-right: 5px"> {{varValue.value}} </td> 
									<td width= "40%" style="padding-left: 5px" > {{varValue.label}} </td>
									<td width= "50%"> <input style ="width : 100%" 
														ng-model="newValue"
														ng-change="setRemapValue(varValue.value,newValue)"> 
														</input> </td>
								</tr>
							</table>
					  	</div>
					</div>
				</div>
				
				
				
				
<!--Calculations -->
				<div class="databox" style="width: 20%">
	
					<div class="header panel-heading">
						<h2>Calculations</h2>
					</div>
				<div class="body" ng-controller="ScriptsSettingsCtrl">
<!-- Script Select-->	<div ng-class="{'unvalidatedUI' : !queryService.queryObject.scriptSelected, 'validatedUI' : queryService.queryObject.scriptSelected}"
						title = "Red flags indicate required selections for query validation">
						
							<ui-select ng-model="queryService.queryObject.scriptSelected" theme="select2" style="width: 97%;">
					    		<ui-select-match allow-clear="true" placeholder="Select Script...">{{$select.selected}}</ui-select-match>
								<ui-select-choices repeat="script in queryService.cache.scriptList">
					       			 <div ng-bind-html="script | highlight: $select.search"></div>
					        	</ui-select-choices>
							</ui-select>
						</div>
					
						
						<h6 class='tool-category'>Script parameters</h6>
<!-- Script options -->	<div class= "tool-bar">
							<table width=100%>
								<tr ng-repeat="input in queryService.cache.scriptMetadata.inputs">
									<td align="right" width=30%>
										<div class="label-p">{{input.param}}:</div>
									</td>
		
									<td style="padding-left: 10px;">
									
										<!-- Handling column types -->
										<!-- TIME -->

										<ui-select ng-if="input.type == 'column'" ng-model="queryService.queryObject.scriptOptions[input.param]" theme="select2" style="width: 97%;">
								    		<ui-select-match allow-clear="true" placeholder="Select column...">{{$select.selected.title}}</ui-select-match>
											<ui-select-choices repeat="column in queryService.cache.columns | filter : { title : $select.search, columnType : input.columnType }">
								       			 <div ng-bind-html="column.title | highlight: $select.search"></div>
								        	</ui-select-choices>
										</ui-select>
										<!-- handling toggle input types -->
										<div class="btn-group btn-toggle"
											ng-if="input.type == 'options' && input.options.length == 2"
											ng-click="toggleButton(input)">
											<button
												ng-class="{'active btn-primary': queryService.queryObject.scriptOptions[input.param] == input.options[0]}"
												class="btn btn-default">{{input.options[0]}}</button>
											<button
												ng-class="{'active btn-primary': queryService.queryObject.scriptOptions[input.param] == input.options[1]}"
												class="btn btn-default">{{input.options[1]}}</button>
										</div>
										<!-- Handling boolean options -->
										<div class="btn-group btn-toggle"
											ng-if="input.type == 'boolean'"
											ng-click="queryService.queryObject.scriptOptions[input.param] = !queryService.queryObject.scriptOptions[input.param]">
											<button
												ng-class="{'active btn-danger': queryService.queryObject.scriptOptions[input.param] == true}"
												class="btn btn-default">True</button>
											<button
												ng-class="{'active btn-danger': queryService.queryObject.scriptOptions[input.param] == false}"
												class="btn btn-default">False</button>
										</div> 
										
										<!-- handling value types -->
										<input style="width: 100%" ng-if="input.type == 'value'"
										ng-model="queryService.queryObject.scriptOptions[input.param]">
										
<!-- 										Handling multiple column types -->
										<ui-select ng-if="input.type == 'multiColumns'" multiple ng-model="queryService.queryObject.scriptOptions[input.param]" theme="select2" style="width: 97%;">
										    <ui-select-match placeholder="Select Columns...">{{$item.title}}</ui-select-match>
										    <ui-select-choices repeat="column in queryService.cache.columns | filter: { title : $select.search, columnType : input.columnType }">
									      	      <div ng-bind-html="column.title | highlight: $select.search"></div>
										    </ui-select-choices>
									    </ui-select>
									<br></td>
								</tr>
							</table>
						</div>
<!-- reidentification prevention -->
<!-- 						Masking Reidentification -->
<!-- 						<div class="input-group"> -->
<!-- 						      <span class="input-group-addon"> -->
<!-- 						        <input type="checkbox" ng-model="service.queryObject.Reidentification.idPrevention" > -->
<!-- 						      </span> -->
<!-- 						      <input type="text" style="z-index: 0" form-control"  ng-model = "service.queryObject.Reidentification.threshold"  -->
<!-- 						      		 ng-Disabled="!service.queryObject.Reidentification.idPrevention"> -->
<!-- 					    </div> -->
						
						
<!-- Validation -->	
						<!-- Tell us status of the execution of query object --><!-- Different from validation status -->
<!-- 						<div style = "display :table" ng-model = "service.isValidated"> -->
<!-- 							 <div style = "display : table-cell; border-radius:5px "  -->
<!-- 							 ng-class="{'validate' : service.queryObject.properties.queryDone, 'invalidate' : !service.queryObject.properties.queryDone}" -->
<!-- 							 title= "A green signal indiactes the query has been executed successfully"> -->
<!-- 							 </div> -->
<!-- 							 <div style= "display : table-cell; padding-left : 5px">{{service.queryObject.properties.queryStatus}}</div> -->
<!-- 						 </div>  -->
						 
					</div>
				</div>
				
				
				
	
<!-- FILTERS -->	
				<div ng-include src="'src/analysis/data_filters/data_filters.html'"></div>
				
				<div ng-controller="dataFilterCtrl">
					<!--Geography filter -->
					<geo-Filter  ng-if="AnalysisService.showGeographyFilter" ng-model= "queryService.queryObject.GeographyFilter"></geo-Filter>
				
					<!--  regular column filter -->	
					<filter  ng-repeat="filter in queryService.queryObject.filterArray" columns="queryService.cache.columns" ng-model='queryService.queryObject.filters[$index]'></filter>
		
					<!-- two columns filter -->
					<tree-filter ng-repeat="filter in queryService.queryObject.treeFilterArray" columns="queryService.cache.columns" ng-model="queryService.queryObject.treeFilters[$index]"></tree-filter>
				</div>
				
				</div>
				
			</div>
		</div>
		
		<input type="checkbox" ng-model="queryService.queryObject.properties.openInNewWindow"> Show Weave in separate window</input>
		
<!-- VIZ TOOL WIDGETS -->	
		<div ng-controller= "toolsCtrl">
				<div class="row " style="height: 50%; clear:both" ng-if="!queryService.queryObject.properties.openInNewWindow">
					<div class="databox" style="width: 25%;" ng-if="!showToolMenu">
						
					</div>
					<div class="databox" style="width: 25%;" ng-if="showToolMenu">
						<div>
							<div>
								<ui-select ng-model="selectedToolToAdd" theme="select2" style="width: 59%;">
									<ui-select-match allow-clear="true" placeholder="Add Tool...">{{$select.selected}}</ui-select-match>
									<ui-select-choices repeat="tool in tool_options | filter :  $select.search">
							       		 <div ng-bind-html="tool | highlight: $select.search"></div>
							        </ui-select-choices>
								</ui-select>
								<button style = "width : 19%" class= "btn btn-sm btn-default" ng-click="addTool(selectedToolToAdd)">Add</button>
								<button style = "width : 19%" class="btn btn-sm btn-default" ng-click="WeaveService.tileWindows()">Tile</button>
							</div>
							
							
							<accordion close-others="true" class="tool-list"> 
							
								<accordion-group ng-repeat="(toolId, tool) in queryService.queryObject.visualizations" style="font-family: 'Open Sans', Arial, sans-serif; font-size: 14px;">
									<accordion-heading>
											{{tool.title || toolId}}
											<!--hack to disable the close button on the first tools -->
 											<a ng-show="fixed_ids.indexOf(toolId) < 0" href="javascript: void(0)"  
												class="close-button" data-trigger="hover" placement="right" title="Remove"  
												ng-click="removeTool(toolId)"> 
												<i style="margin:8px 0px 2px 10px; font-size: 10px" class="glyphicon glyphicon-remove"></i> 
											</a>
									</accordion-heading>
									<div ng-include="tool.template_url"></div>
								</accordion-group>
								
							</accordion>
						</div>
					</div>
					<div id="flashContent" style="width: 70%; height: 800px; float:left"></div>
				</div>
				
				<!-- individual tool widgets when Weave is opened in a new window -->
				<div class="row " style="height: 50%; clear:both" ng-show="queryService.queryObject.properties.openInNewWindow">
					<div style="height:100%; width: 100%;">
							<div style="width: 20%; float : left; margin-right : 20px" ng-repeat="tool in queryService.queryObject.visualizations" class="panel panel-default">
									<div class="panel-heading">
										<h2>{{tool.title}}</h2>
											<a ng-show="$index > 5" href="javascript: void(0)"  
												class="close-button" data-trigger="hover" placement="right" title="Remove"  
												ng-click="removeTool($index)"> 
												<i style="margin:8px 0px 2px 10px; font-size: 10px" class="glyphicon glyphicon-remove"></i> 
											</a>			
									</div>
									<h5 class="widget-description "><i style="font-size: 14px; padding-right: 5px" class="glyphicon glyphicon-info-sign"></i> {{widget_brick.description}}</h5>
									<h6 style = "font-size: 13px" class="widget-description" ng-show = "tool.note"> {{widget_brick.note}} </h6>
									<div class="" ng-include="tool.template_url"></div>
							</div>
							

					</div>

				</div>
</div>

<!-- QUERY OBJECT PANEL -->						
	<div id="queryObjectPanel" class="databox" style="width: 50%; height: 400px; position: relative; top: -1059px; left: 496px;" 
			ng-show="!queryService.queryObject.properties.hideQueryObjectPanel">
			<!-- <div class="databox" style="width: 200px;"> -->
			<div class=" header panel-heading" style="margin-bottom: 0px">
				<h2>Query Object Editor</h2>
				<a href="javascript: void(0)" 
					class="close-button" data-trigger="hover" placement="right" title="Remove"  
					ng-click="queryService.queryObject.properties.hideQueryObjectPanel = true"> 
					<i style="margin:8px 0px 2px 10px; font-size: 10px" class="glyphicon glyphicon-remove"></i> 
				</a>
			</div>
			
			<div id="qobjPanelContent" 
				 class="body" style="width: 100%; height:100%; border: solid 4px; border-color: #4C4F53">
				<br>
				<div style="width: 100%; height: 100%;">
					<div id="queryObjTree" style="width: 50%; height: 80%; overflow:hidden; float:left"></div>
  					
  					<div ng-if="!isValue" style="width: 50%; height: 80%; float:right">
 						<div class="gridStyle" ng-grid="qobjGridOptions"></div>
  					</div>
  					<textarea ng-show="isValue" ng-model = "selectedValue.value"  style="width: 50%; height: 80%; float:right"/>
				</div>
			</div>
	</div>